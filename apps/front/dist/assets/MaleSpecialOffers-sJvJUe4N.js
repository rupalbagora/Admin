import{b as c,j as e,u as F,a as T,T as x,U as k,V as R,W as E}from"./index-BUwxZ0dz.js";import{d as A,D as U}from"./index-CwvPk9S2.js";import{F as i,I,B as p}from"./index-D91Dgcjk.js";import{M as Y}from"./index-HnUezucs.js";import{T as P}from"./index-BsRJsCrQ.js";import{U as q,F as L,P as N,R as $}from"./DeleteOutlined-CY-A2Q_x.js";import{R as V}from"./UploadOutlined-BZUwM306.js";import{s as d,C as _}from"./AntdIcon-D9VCaoNQ.js";import{S as w}from"./index-DenBw2B0.js";import{R as B}from"./ReloadOutlined-aA4FmXlz.js";import{R as v}from"./PlusOutlined-05gYRiNT.js";import{T as O,R as z}from"./EditOutlined-BMN32wtQ.js";import"./objectWithoutPropertiesLoose-k0w7FEql.js";const K=({visible:t,onCancel:g,onSubmit:u,initialData:r,loading:j=!1})=>{const[o]=i.useForm(),[f,l]=c.useState([]);c.useEffect(()=>{r&&t?(o.setFieldsValue({title:r.title,discount:Number(r.discount),date:A(r.date),description:r.description}),l(r.imageUrl?[{uid:"-1",name:"Existing Image",status:"done",url:r.imageUrl}]:[])):(o.resetFields(),l([]))},[r,o,t]);const h=async n=>{try{const a=new FormData;a.append("title",n.title),a.append("discount",n.discount.toString()),a.append("date",n.date.format("YYYY-MM-DD")),a.append("description",n.description),a.append("gender","Male"),f.length>0&&f[0].originFileObj&&a.append("image",f[0].originFileObj),u(a,r==null?void 0:r._id)}catch{d.error("Something went wrong while saving the male offer")}},y=()=>{o.resetFields(),l([]),g()};return e.jsx(Y,{title:e.jsx("span",{children:r?"Edit Male Offer":"Add Offer"}),open:t,onCancel:y,onOk:()=>o.submit(),okText:r?"Update Male Offer":"Add Offer",confirmLoading:j,destroyOnClose:!0,width:600,children:e.jsxs(i,{form:o,layout:"vertical",onFinish:h,children:[e.jsx(i.Item,{label:"Title",name:"title",rules:[{required:!0,message:"Please enter title"}],children:e.jsx(I,{placeholder:"Enter male offer title"})}),e.jsx(i.Item,{label:"Discount (%)",name:"discount",rules:[{required:!0,message:"Please enter discount"},{type:"number",min:0,max:100,message:"Discount must be between 0 and 100"}],children:e.jsx(P,{min:0,max:100,style:{width:"100%"},placeholder:"Enter discount percentage"})}),e.jsx(i.Item,{label:"Date",name:"date",rules:[{required:!0,message:"Please select date"}],children:e.jsx(U,{style:{width:"100%"},format:"YYYY-MM-DD",placeholder:"Select offer date"})}),e.jsx(i.Item,{label:"Description",name:"description",rules:[{required:!0,message:"Please enter description"}],children:e.jsx(I.TextArea,{rows:3,placeholder:"Enter offer description for male customers"})}),e.jsxs(i.Item,{label:"Offer Image",rules:r?[]:[{required:!0,message:"Please upload an image"}],children:[e.jsx(q,{listType:"picture",maxCount:1,fileList:f,onChange:({fileList:n})=>l(n),beforeUpload:()=>!1,accept:"image/*",children:e.jsx(p,{icon:e.jsx(V,{}),children:r?"Change Image":"Select Image"})}),!r&&e.jsx("div",{style:{color:"#999",fontSize:"12px",marginTop:"4px"},children:"Image is required for new offers"})]})]})})},{Search:W}=I,le=()=>{const t=F(),{offers:g,loading:u,error:r}=T(s=>s.offers),[j,o]=c.useState(!1),[f,l]=c.useState(null),[h,y]=c.useState("");c.useEffect(()=>{t(x())},[t]),c.useEffect(()=>{r&&d.error(r)},[r]);const n=g.filter(s=>s.gender==="Male"),a=async(s,m)=>{try{m?(await t(k({id:m,formData:s})).unwrap(),d.success("âœ… Male offer updated successfully")):(await t(R(s)).unwrap(),d.success("âœ… Male offer added successfully")),o(!1),l(null),t(x())}catch(C){d.error(C||"Operation failed")}},b=async s=>{try{await t(E(s)).unwrap(),d.success("ðŸ—‘ï¸ Male offer deleted successfully"),t(x())}catch{d.error("Failed to delete offer")}},S=n.filter(s=>s.title.toLowerCase().includes(h.toLowerCase())),M=[{title:"Image",dataIndex:"imageUrl",key:"imageUrl",render:s=>s?e.jsx("img",{src:s,alt:"offer",style:{width:60,height:60,borderRadius:6,objectFit:"cover"}}):e.jsx(O,{color:"red",children:"No Image"})},{title:"Title",dataIndex:"title",key:"title"},{title:"Discount",dataIndex:"discount",key:"discount",render:s=>`${s}%`},{title:"Date",dataIndex:"date",key:"date",render:s=>e.jsx(O,{color:"blue",children:s})},{title:"Description",dataIndex:"description",key:"description",ellipsis:!0},{title:"Actions",key:"actions",render:(s,m)=>e.jsxs(w,{children:[e.jsx(p,{type:"primary",icon:e.jsx(z,{}),onClick:()=>{l(m),o(!0)}}),e.jsx(N,{title:"Are you sure to delete this male offer?",onConfirm:()=>b(m._id),okText:"Yes",cancelText:"No",children:e.jsx(p,{danger:!0,icon:e.jsx($,{})})})]})}];return e.jsxs(_,{title:e.jsxs("span",{children:["Male Special Offers    (",n.length," offers)"]}),extra:e.jsxs(w,{children:[e.jsx(p,{icon:e.jsx(B,{}),onClick:()=>t(x()),loading:u,children:"Refresh"}),e.jsx(p,{type:"primary",icon:e.jsx(v,{}),onClick:()=>{l(null),o(!0)},children:"Add New Offer"})]}),children:[e.jsx(W,{placeholder:"Search male offers by title...",value:h,onChange:s=>y(s.target.value),allowClear:!0,style:{marginBottom:16,width:"50%"}}),e.jsx(L,{rowKey:"_id",columns:M,dataSource:S,loading:u,pagination:{pageSize:5},locale:{emptyText:"No male offers found"}}),e.jsx(K,{visible:j,onCancel:()=>{o(!1),l(null)},onSubmit:a,initialData:f,loading:u})]})};export{le as default};
