import{r as S,u as I,a as E,b,f as O,j as c,s as A,A as v}from"./index-BUwxZ0dz.js";var o={},g={},P;function D(){if(P)return g;P=1,Object.defineProperty(g,"__esModule",{value:!0});class u{constructor(i){this.instance=void 0,this.options=i,typeof window<"u"&&(this.instance=new window.Razorpay(this.options))}on(i,s){if(!this.instance)throw new Error("Razorpay Instance in not ready");this.instance.on(i,s)}open(){if(!this.instance)throw new Error("Razorpay Instance in not ready");this.instance.open()}}return g.default=u,g}var x;function N(){if(x)return o;x=1;var u=o&&o.__createBinding||(Object.create?(function(t,r,a,e){e===void 0&&(e=a);var n=Object.getOwnPropertyDescriptor(r,a);(!n||("get"in n?!r.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return r[a]}}),Object.defineProperty(t,e,n)}):(function(t,r,a,e){e===void 0&&(e=a),t[e]=r[a]})),y=o&&o.__setModuleDefault||(Object.create?(function(t,r){Object.defineProperty(t,"default",{enumerable:!0,value:r})}):function(t,r){t.default=r}),i=o&&o.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(t!=null)for(var a in t)a!=="default"&&Object.prototype.hasOwnProperty.call(t,a)&&u(r,t,a);return y(r,t),r},s=o&&o.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(o,"__esModule",{value:!0}),o.useRazorpay=void 0;const d=i(S()),h=s(D()),l=(t,...r)=>{},w=()=>{const[t,r]=d.useState(!1),[a,e]=d.useState(),n=typeof window<"u",f=()=>!(!n||!("Razorpay"in window));function _(p){return new Promise((R,z)=>{const m=window.document.createElement("script");m.src=p,m.onload=function(){R()},m.onerror=function(j){z(j.toString())},document.body.appendChild(m)})}return d.useEffect(()=>{if(l(),!n){l();return}r(!0),f()||(l(),_("https://checkout.razorpay.com/v1/checkout.js").then(()=>{l(),e(void 0)}).catch(p=>{l("script loading error",p),p instanceof Error?e(p.message):e("Unknown Error")}).finally(()=>r(!1)))},[]),{error:a,isLoading:t,Razorpay:h.default}};return o.useRazorpay=w,o}var C=N(),M={};const $=()=>{const u=I(),{plans:y,currentPlan:i}=E(e=>e.subscriptionPlans),[s,d]=b.useState(null),[h,l]=b.useState(!1);b.useEffect(()=>{u(O())},[u]);const w=e=>{d(e._id),u(A(e))},{Razorpay:t}=C.useRazorpay(),r=async()=>{if(!(!s||!i)){l(!0);try{const{data:e}=await v.post("/payments/order",{planId:s},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),{orderId:n}=e,f={key:M.REACT_APP_RAZORPAY_KEY||"rzp_test_123456789",amount:i.price*100,currency:i.currency||"INR",name:"Your SaaS Platform",description:`${i.name} Plan`,order_id:n,handler:async _=>{await a(_)},prefill:{name:"John Doe",email:"user@example.com",contact:"9999999999"},theme:{color:"#4f46e5"}};typeof window<"u"&&t?new t(f).open():alert("Razorpay SDK not loaded")}catch(e){console.error("Payment error:",e)}finally{l(!1)}}},a=async e=>{try{await v.post("/payments/verify",{...e,planId:s},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),window.location.reload()}catch(n){console.error("Verification error:",n)}};return c.jsxs("div",{className:"py-12 max-w-7xl mx-auto px-4",children:[c.jsx("h2",{className:"text-3xl font-bold text-center mb-8",children:"Choose Your Plan"}),c.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:y.map(e=>c.jsxs("div",{className:`border p-6 rounded-lg ${s===e._id?"border-indigo-600":"border-gray-300"}`,onClick:()=>w(e),children:[c.jsx("h3",{className:"text-xl font-semibold",children:e.name}),c.jsxs("p",{className:"text-lg mt-2",children:[e.currency,e.price," / ",e.billingInterval]}),c.jsx("ul",{className:"mt-4 space-y-1 text-sm",children:e.features.map((n,f)=>c.jsxs("li",{children:["âœ“ ",n]},f))}),c.jsx("button",{onClick:n=>{n.stopPropagation(),r()},disabled:s!==e._id||h,className:`mt-6 w-full py-2 px-4 text-white rounded ${s===e._id?"bg-indigo-600 hover:bg-indigo-700":"bg-gray-400 cursor-not-allowed"}`,children:h&&s===e._id?"Processing...":"Subscribe Now"})]},e._id))})]})};export{$ as default};
