import{b as n,j as e,u as R,a as L,K as h,M as U,N as A,P as E}from"./index-BUwxZ0dz.js";import{F as x,I as b,B as m}from"./index-D91Dgcjk.js";import{U as v,F as M,P as O,R as N}from"./DeleteOutlined-CY-A2Q_x.js";import{R as P}from"./UploadOutlined-BZUwM306.js";import{s as d,C as q}from"./AntdIcon-D9VCaoNQ.js";import{M as $}from"./index-HnUezucs.js";import{S as j}from"./index-DenBw2B0.js";import{R as _}from"./ReloadOutlined-aA4FmXlz.js";import{R as z}from"./PlusOutlined-05gYRiNT.js";import{T as B,R as V}from"./EditOutlined-BMN32wtQ.js";import"./objectWithoutPropertiesLoose-k0w7FEql.js";const K=({visible:i,onSubmit:p,initialData:r})=>{const[c]=x.useForm(),[o,s]=n.useState([]);n.useEffect(()=>{r&&i?(c.setFieldsValue({title:r.title}),s(r.imageUrl?[{uid:"-1",name:"Existing Certificate",status:"done",url:r.imageUrl}]:[])):(c.resetFields(),s([]))},[r,c,i]);const u=async a=>{try{const l=new FormData;if(l.append("title",a.title),o.length>0&&o[0].originFileObj)l.append("certificateImage",o[0].originFileObj);else if(!r&&o.length===0){d.error("Please upload a certificate image");return}await p(l,r==null?void 0:r._id)}catch(l){console.error("Form submission error:",l),d.error("Something went wrong while saving the certificate")}};return e.jsxs(x,{form:c,layout:"vertical",onFinish:u,className:"certificate-form",children:[e.jsx(x.Item,{label:"Certificate Title",name:"title",rules:[{required:!0,message:"Please enter certificate title"}],children:e.jsx(b,{placeholder:"Enter certificate title"})}),e.jsxs(x.Item,{label:"Certificate Image",required:!r,rules:r?[]:[{required:!0,message:"Please upload certificate image"}],children:[e.jsx(v,{listType:"picture",maxCount:1,fileList:o,onChange:({fileList:a})=>s(a),beforeUpload:()=>!1,accept:"image/*",children:e.jsx(m,{icon:e.jsx(P,{}),children:r?"Change Certificate Image":"Upload Certificate Image"})}),!r&&e.jsx("div",{style:{color:"#999",fontSize:"12px",marginTop:"4px"},children:"Certificate image is required for new certificates"}),r&&e.jsx("div",{style:{color:"#999",fontSize:"12px",marginTop:"4px"},children:"Leave empty to keep existing image"})]}),e.jsx("button",{type:"submit",style:{display:"none"},className:"certificate-form-submit-button"})]})},{Search:Y}=b,ie=()=>{const i=R(),{certificates:p=[],loading:r=!1,error:c=null}=L(t=>t.certificates),[o,s]=n.useState(!1),[u,a]=n.useState(null),[l,w]=n.useState(""),[C,y]=n.useState(!1);n.useEffect(()=>{i(h())},[i]),n.useEffect(()=>{c&&d.error(c)},[c]);const S=async(t,f)=>{try{y(!0),f?(await i(U({id:f,formData:t})).unwrap(),d.success("âœ… Certificate updated successfully")):(await i(A(t)).unwrap(),d.success("âœ… Certificate added successfully")),s(!1),a(null),i(h())}catch(g){console.error("Operation error:",g),d.error((g==null?void 0:g.message)||"Operation failed")}finally{y(!1)}},F=async t=>{try{await i(E(t)).unwrap(),d.success("ðŸ—‘ï¸ Certificate deleted successfully"),i(h())}catch{d.error("Failed to delete certificate")}},I=()=>{const t=document.querySelector(".certificate-form-submit-button");t&&t.click()},T=p.filter(t=>t.title.toLowerCase().includes(l.toLowerCase())),k=[{title:"Certificate Image",dataIndex:"imageUrl",key:"imageUrl",render:t=>t?e.jsx("img",{src:t,alt:"certificate",width:80,height:60,style:{borderRadius:6,objectFit:"cover"}}):e.jsx(B,{color:"red",children:"No Image"})},{title:"Title",dataIndex:"title",key:"title"},{title:"Uploaded Date",dataIndex:"createdAt",key:"createdAt",render:t=>t?new Date(t).toLocaleDateString():"-"},{title:"Actions",key:"actions",render:(t,f)=>e.jsxs(j,{children:[e.jsx(m,{type:"primary",icon:e.jsx(V,{}),onClick:()=>{a(f),s(!0)}}),e.jsx(O,{title:"Are you sure to delete this certificate?",onConfirm:()=>F(f._id),okText:"Yes",cancelText:"No",children:e.jsx(m,{danger:!0,icon:e.jsx(N,{})})})]})}];return e.jsxs(q,{title:`Certificate Management &nbsp; (${p.length} certificates)`,extra:e.jsxs(j,{children:[e.jsx(m,{icon:e.jsx(_,{}),onClick:()=>i(h()),loading:r,children:"Refresh"}),e.jsx(m,{type:"primary",icon:e.jsx(z,{}),onClick:()=>{a(null),s(!0)},children:"Add Certificate"})]}),children:[e.jsx(Y,{placeholder:"Search certificates by title...",value:l,onChange:t=>w(t.target.value),allowClear:!0,style:{marginBottom:16,width:"50%"}}),e.jsx(M,{rowKey:"_id",columns:k,dataSource:T,loading:r,pagination:{pageSize:5},locale:{emptyText:"No certificates found"}}),e.jsx($,{title:u?"Edit Certificate":"Add Certificate",open:o,onCancel:()=>{s(!1),a(null)},onOk:I,okText:u?"Update":"Create",confirmLoading:C,width:600,destroyOnClose:!0,children:e.jsx(K,{visible:o,onCancel:()=>{s(!1),a(null)},onSubmit:S,initialData:u,loading:C})})]})};export{ie as default};
