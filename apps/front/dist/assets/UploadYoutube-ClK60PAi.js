import{n as z,b as d,j as e,u as W,a as G,G as w,H as K,I as J,J as Q}from"./index-BUwxZ0dz.js";import{F as y,I as R,B as g}from"./index-D91Dgcjk.js";import{a as T,U as X,F as Z,P as D,R as ee}from"./DeleteOutlined-CY-A2Q_x.js";import{S as b}from"./index-DenBw2B0.js";import{I as A,s as h,C as te}from"./AntdIcon-D9VCaoNQ.js";import{R as L}from"./UploadOutlined-BZUwM306.js";import{M as Y}from"./index-HnUezucs.js";import{R as oe}from"./ReloadOutlined-aA4FmXlz.js";import{R as ie}from"./PlusOutlined-05gYRiNT.js";import{T as F,R as re}from"./EditOutlined-BMN32wtQ.js";import"./objectWithoutPropertiesLoose-k0w7FEql.js";var C={},M;function le(){if(M)return C;M=1,Object.defineProperty(C,"__esModule",{value:!0});var o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"};return C.default=o,C}var se=le();const ne=z(se);function I(){return I=Object.assign?Object.assign.bind():function(o){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(o[s]=i[s])}return o},I.apply(this,arguments)}const ae=(o,a)=>d.createElement(A,I({},o,{ref:a,icon:ne})),$=d.forwardRef(ae);var U={},_;function de(){if(_)return U;_=1,Object.defineProperty(U,"__esModule",{value:!0});var o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 302.3L784 376V224c0-35.3-28.7-64-64-64H128c-35.3 0-64 28.7-64 64v576c0 35.3 28.7 64 64 64h592c35.3 0 64-28.7 64-64V648l128 73.7c21.3 12.3 48-3.1 48-27.6V330c0-24.6-26.7-40-48-27.7zM712 792H136V232h576v560zm176-167l-104-59.8V458.9L888 399v226zM208 360h112c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H208c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"video-camera",theme:"outlined"};return U.default=o,U}var ue=de();const ce=z(ue);function E(){return E=Object.assign?Object.assign.bind():function(o){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(o[s]=i[s])}return o},E.apply(this,arguments)}const pe=(o,a)=>d.createElement(A,E({},o,{ref:a,icon:ce})),he=d.forwardRef(pe),fe=({visible:o,onSubmit:a,initialData:i})=>{const[s]=y.useForm(),[u,p]=d.useState([]),[c,f]=d.useState("youtube");d.useEffect(()=>{if(o)if(i){console.log("Editing video data:",i);const l=i.videoUrl?"youtube":"upload";f(l),s.setFieldsValue({title:i.title,videoUrl:i.videoUrl||""}),i.videoPath?p([{uid:"-1",name:"Existing Video",status:"done",url:i.videoPath}]):p([])}else s.resetFields(),p([]),f("youtube")},[i,s,o]);const m=async l=>{try{console.log("Form values:",l),console.log("File list:",u),console.log("Initial data:",i);const n=new FormData;n.append("title",l.title);const j=!!i;if(c==="youtube"?(l.videoUrl&&l.videoUrl.trim()!==""?n.append("videoUrl",l.videoUrl.trim()):j&&l.videoUrl===""&&n.append("videoUrl",""),u.length>0&&p([])):c==="upload"&&u.length>0&&u[0].originFileObj&&n.append("video",u[0].originFileObj),!j){const S=l.videoUrl&&l.videoUrl.trim()!=="",P=u.length>0&&u[0].originFileObj;if(!S&&!P){h.error("Please provide either a YouTube link or upload a video file");return}}console.log("Submitting form data..."),await a(n,i==null?void 0:i._id)}catch(n){console.error("Form submission error:",n),h.error("Something went wrong while saving the video")}},V=({fileList:l})=>{p(l)},O=l=>{const n=l.target.value;f(n),n==="youtube"?p([]):s.setFieldsValue({videoUrl:""})},v=!!i;return e.jsxs(y,{form:s,layout:"vertical",onFinish:m,className:"youtube-video-form",children:[e.jsx(y.Item,{label:"Video Title",name:"title",rules:[{required:!0,message:"Please enter video title"}],children:e.jsx(R,{placeholder:"Enter video title"})}),e.jsx(y.Item,{label:"Video Source",children:e.jsx(T.Group,{value:c,onChange:O,style:{marginBottom:16},children:e.jsxs(b,{direction:"vertical",children:[e.jsx(T,{value:"youtube",children:e.jsxs(b,{children:[e.jsx($,{}),"YouTube Link"]})}),e.jsx(T,{value:"upload",children:e.jsxs(b,{children:[e.jsx(L,{}),"Upload Video File"]})})]})})}),c==="youtube"&&e.jsx(y.Item,{label:"YouTube URL",name:"videoUrl",help:v?"Leave empty to remove existing YouTube URL":"Enter YouTube video URL",children:e.jsx(R,{placeholder:"Paste YouTube video URL (e.g., https://youtube.com/watch?v=...)",allowClear:!0})}),c==="upload"&&e.jsxs(y.Item,{label:"Upload Video File",help:v?"Upload a new file to replace existing video":"Upload a video file",children:[e.jsx(X,{listType:"text",maxCount:1,fileList:u,onChange:V,beforeUpload:()=>!1,accept:"video/*",onRemove:()=>(p([]),!0),children:e.jsx(g,{icon:e.jsx(L,{}),children:v?"Replace Video File":"Select Video File"})}),e.jsx("div",{style:{color:"#999",fontSize:"12px",marginTop:"4px"},children:"Supported formats: MP4, MOV, AVI, MKV"})]}),e.jsx("button",{type:"submit",style:{display:"none"},className:"youtube-video-form-submit-button"})]})},{Search:me}=R,Se=()=>{const o=W(),a=G(t=>t.youtubeVideos||{videos:[],loading:!1,error:null}),{videos:i=[],loading:s=!1,error:u=null}=a,[p,c]=d.useState(!1),[f,m]=d.useState(null),[V,O]=d.useState(""),[v,l]=d.useState(!1),[n,j]=d.useState({visible:!1,url:void 0,title:void 0});d.useEffect(()=>{o(w())},[o]),d.useEffect(()=>{u&&h.error(u)},[u]);const S=async(t,r)=>{try{l(!0),r?(await o(K({id:r,formData:t})).unwrap(),h.success("Video updated successfully")):(await o(J(t)).unwrap(),h.success(" Video added successfully")),c(!1),m(null),o(w())}catch(x){console.error("Operation error:",x),h.error((x==null?void 0:x.message)||"Operation failed")}finally{l(!1)}},P=async t=>{try{await o(Q(t)).unwrap(),h.success("ðŸ—‘ï¸ Video deleted successfully"),o(w())}catch{h.error("Failed to delete video")}},B=()=>{const t=document.querySelector(".youtube-video-form");if(t){const r=t.querySelector(".youtube-video-form-submit-button");r&&r.click()}},q=t=>{console.log("Editing video:",t),m(t),c(!0)},k=t=>{if(t.videoUrl)window.open(t.videoUrl,"_blank");else if(t.videoPath){let r=t.videoPath;t.videoPath.startsWith("/")&&(r=`${window.location.origin}${t.videoPath}`),window.location.protocol==="https:"&&r.startsWith("http:")&&(r=r.replace("http://","https://")),j({visible:!0,url:r,title:t.title})}},H=i.filter(t=>t.title.toLowerCase().includes(V.toLowerCase())),N=[{title:"Type",key:"type",render:(t,r)=>e.jsx(b,{children:r.videoUrl?e.jsx(F,{icon:e.jsx($,{}),color:"red",children:"YouTube"}):e.jsx(F,{icon:e.jsx(he,{}),color:"blue",children:"Uploaded"})})},{title:"Title",dataIndex:"title",key:"title"},{title:"Source",key:"source",render:(t,r)=>e.jsx("div",{style:{maxWidth:200},children:r.videoUrl?e.jsx("a",{href:r.videoUrl,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"12px",wordBreak:"break-all"},onClick:x=>{x.preventDefault(),k(r)},children:r.videoUrl}):r.videoPath?e.jsx(g,{type:"link",onClick:()=>k(r),style:{fontSize:"12px",padding:0,height:"auto"},children:"Play Uploaded Video"}):e.jsx(F,{color:"orange",children:"No Source"})})},{title:"Uploaded Date",dataIndex:"uploadedAt",key:"uploadedAt",render:t=>new Date(t).toLocaleDateString()},{title:"Actions",key:"actions",render:(t,r)=>e.jsxs(b,{children:[e.jsx(g,{type:"primary",icon:e.jsx(re,{}),onClick:()=>q(r)}),e.jsx(D,{title:"Are you sure to delete this video?",onConfirm:()=>P(r._id),okText:"Yes",cancelText:"No",children:e.jsx(g,{danger:!0,icon:e.jsx(ee,{})})})]})}];return e.jsxs(e.Fragment,{children:[e.jsxs(te,{title:"YouTube Video Management",extra:e.jsxs(b,{children:[e.jsx(g,{icon:e.jsx(oe,{}),onClick:()=>o(w()),loading:s,children:"Refresh"}),e.jsx(g,{type:"primary",icon:e.jsx(ie,{}),onClick:()=>{m(null),c(!0)},children:"Add Video"})]}),children:[e.jsx(me,{placeholder:"Search videos by title...",value:V,onChange:t=>O(t.target.value),allowClear:!0,style:{marginBottom:16,width:"50%"}}),e.jsx(Z,{rowKey:"_id",columns:N,dataSource:H,loading:s,pagination:{pageSize:5},locale:{emptyText:"No videos found"}}),e.jsx(Y,{title:f?"Edit Video":"Add Video",open:p,onCancel:()=>{c(!1),m(null)},onOk:B,okText:f?"Update":"Create",confirmLoading:v,width:700,destroyOnClose:!0,children:e.jsx(fe,{visible:p,onCancel:()=>{c(!1),m(null)},onSubmit:S,initialData:f,loading:v})})]}),e.jsx(Y,{title:n.title||"Video Preview",open:n.visible,onCancel:()=>j({visible:!1,url:void 0,title:void 0}),footer:null,width:800,destroyOnClose:!0,children:n.url&&e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("video",{controls:!0,autoPlay:!0,style:{width:"100%",maxHeight:"500px",borderRadius:"8px"},children:[e.jsx("source",{src:n.url,type:"video/mp4"}),"Your browser does not support the video tag."]},n.url),e.jsx("div",{style:{marginTop:"16px",color:"#666"},children:e.jsx("small",{children:"If video doesn't play, ensure your server supports HTTPS video streaming"})})]})})]})};export{Se as default};
